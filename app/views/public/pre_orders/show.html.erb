<div class="container d-flex flex-row-reverse pt-3">
  <div class="col-9 px-3">
    <h2>予約内容詳細</h2><%= @pre_order.order_full_name %>
    <hr>
    <!--ショップ情報-->
    <table class="table table-bordered table-light">
      <tr>
        <th class="w-25">予約状況</th>
        <td>
          <div class="col-5 mb-2"><%= render 'shop/pre_orders/status', pre_order: @pre_order %></div>
          <span class="fw-bold">
            <% if @pre_order.status == 'visit' %>
              ご来店ありがとうございました。
            <% elsif @pre_order.status == 'before_visit' %>
              <span class="text-danger">ご来店お待ちしています。</span>
            <% else %>
            <% end %>
          </span>
        </td>
      </tr>
      <tr>
        <th>来店日時</th>
        <td><%= @pre_order.visit_day.strftime("%Y年%m月%d日") %> <%= @pre_order.visit_time.strftime( "%H時%M分" ) %></td>
      </tr>
      <tr>
        <th>ショップ情報</th>
        <td>
          <%= link_to shop_path(@pre_order.item.shop.id), class: "text-decoration-none" do %>
            <span class="fw-bold">
              <%= @pre_order.item.shop.name %>
            </span><br>
            <span>
              <%= @pre_order.item.shop.address %>
            </span>
          <% end %>
        </td>
      </tr>
    </table>
    <!--商品情報-->
    <table class="table table-bordered table-light">
      <tr>
        <th class="w-25">予約商品</th>
        <td>
          <%= link_to item_path(@pre_order.item), class: "text-decoration-none" do %>
            <%= @pre_order.name %>
            <small>[ <%= @pre_order.item.id %> ]</small>
          <% end %>
        </td>
      </tr>
      <tr>
        <th>商品単価</th>
        <td><%= (@pre_order.total_payment / @pre_order.amount).to_s(:delimited) %>円</td>
      </tr>
      <tr>
        <th>予約数</th>
        <td><%= @pre_order.amount %>個</td>
      </tr>
      <tr>
        <th>お支払予定金額</th>
        <td>
          <span class="fw-bold"><%= @pre_order.total_payment.to_s(:delimited) %> 円</span><br>
          ※来店時にショップへお支払いください
        </td>
      </tr>
      <tr>
        <th class="w-25">用途</th>
        <td><%= @pre_order.purpose %></td>
      </tr>
      <tr>
        <th class="w-25">備考</th>
        <td><%= @pre_order.note %></td>
      </tr>
    </table>

    <table class="table table-bordered table-light">
      <tr>
        <th class="w-25">キャンセル期限</th>
        <td><%= @pre_order.item.deadline %>日前まで
        </td>
      </tr>
      <tr>
        <th>キャンセル規定</th>
        <td>
          受取予定日の<%= @pre_order.item.deadline %>日前: 合計金額の100%<br>
          無断: 合計金額の100%<br>
          ※キャンセルの場合は期限日までに必ずショップへご連絡ください。
        </td>
      </tr>
      <tr>
        <th>予約番号</th>
        <td><%= @pre_order.id %></td>
      </tr>
    </table>
    <% if @pre_order.status == 'visit' && @pre_order.review.blank? && @pre_order.visit_day > 1.week.ago %>
      <%= form_with model: @review, url: pre_order_reviews_path(@pre_order), method: :post do |f| %>
        <%= render "layouts/error_messages", obj: @review %>
        <div class="col-5 my-2">
          <%= f.text_area :content, placeholder: 'この商品やショップの口コミを入力してください', class: "form-control" %>
          <%= f.submit '口コミを投稿する', "data-confirm" => "投稿は編集できません。この内容で投稿しますか？" , class: "btn btn-info mt-2" %>
        </div>
      <% end %>
    <% else %>
    <% end %>
  </div>
  <div class="col-3 px-3">
    <%= render 'layouts/members_menu' %>
    <%= render 'layouts/homes_menu', tag_rank: @tag_rank %>
  </div>
</div>